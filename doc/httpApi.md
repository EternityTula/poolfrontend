# Table of contents

* [Common status values suitable for all operations](#common-status-values-suitable-for-all-operations)
* [User management](#user-management)
   * [userCreate](#usercreate)
   * [userResendEmail](#userresendemail)
   * [userAction](#useraction)
   * [userLogin](#userlogin)
   * [userLogout](#userlogout)
   * [userGetCredentials](#usergetcredentials)
   * [userUpdateSettings](#userupdatesettings)
* [Backend API functions](#backend-api-functions)
   * [backendManualPayout](#backendmanualpayout)
   * [backendQueryUserBalance](#backendqueryuserbalance)
   * [backendQueryFoundBlocks](#backendqueryfoundblocks)
   * [backendQueryPayouts](#backendquerypayouts)
   * [backendQueryPoolStats](#backendquerypoolstats)
   * [backendQueryUserStats](#backendqueryuserstats)

# Common status values suitable for all operations

* ok: operation success
* json_format_error: request is not correct json or argument type mismatch
* request_format_error: invalid function arguments passed

# User management

## userCreate
Register new user and send email with activation link if parameter <poolfrontend.smtpEnabled> is "true" in pool config. Activation link format is http://<poolfrontend.poolHostAddress><poolfrontend.poolActivateLinkPrefix><actionId>, where poolfrontend.poolHostAddress and poolfrontend.poolActivateLinkPrefix defined in pool config; actionId: 512-bit unique identifier of operation, that can be user as input parameter of 'useraction' api.
Pool frontend must have a handler for configured activation link fornat.

### query type: POST
### arguments:
* login:string - Unique user identifier (up to 64 characters)
* password:string - Password (8-64 characters length)
* email:string - User email
* name:string - User name (display instead of login in 'blocks found by pool' table (up to 256 characters)

### return values:
* status:string - can be one of common status values or:
  * login_format_invalid
  * password_format_invalid
  * email_format_invalid
  * name_format_invalid
  * duplicate_email: already have another user with requested email
  * duplicate_login: already have user with requested login
  * smtp_client_create_error: internal error with SMTP protocol client
  * email_send_error: error received from SMTP server, details in pool log

### curl example:
```
curl -X POST -d "{\"login\": \"user\", \"password\": \"12345678\", \"email\": \"my@email.com\"}" http://localhost:18880/api/userCreate
```

### response examples:
```
{"status": "ok"}
```
```
{"status": "duplicate_email"}
```

### activation link format example:
```
http://localhost/actions/useracivate?id=6310abb30747f6498a5ec114fdfcc844babdbd9566bcc69e9a2472536a6a850892f339e0866215140497e186710cc15af5582de5e222e4e4a6089dcfd0270017
```

## userResendEmail
Create new user activation id and send it by email. Useful when first email with activation link not received by user.

### query type: POST
### arguments:
* login:string - Unique user identifier (up to 64 characters)
* password:string - Password (8-64 characters length)

### return values:
* status:string - can be one of common status values or:
  * invalid_password
  * user_already_active
  * smtp_client_create_error: internal error with SMTP protocol client
  * email_send_error: error received from SMTP server, details in pool log

### curl example:
```
curl -X POST -d "{\"login\": \"user\", \"password\": \"12345678\", \"email\": \"my@email.com\"}" http://localhost:18880/api/userResendEmail
```
### response examples:
```
{"status": "ok"}
```
```
{"status": "user_already_active"}
```

## userAction
Confirm various user actions, such as user activation, changing password, etc

### query type: POST
### arguments:
* id:string - unique identifier of operation generated by another api function

### return values:
* status:string - can be one of common status values or:
  * unknown_id: invalid or already activated id
  * unknown_login: internal error
  * user_already_active: internal error
  * unknown_type: internal error

### curl example:
```
curl -X POST -d "{\"id\": \"6310abb30747f6498a5ec114fdfcc844babdbd9566bcc69e9a2472536a6a850892f339e0866215140497e186710cc15af5582de5e222e4e4a6089dcfd0270017\"}" http://localhost:18880/api/userAction
```
### response examples:
```
{"status": "ok"}
```
```
{"status": "unknown_id"}
```

## userLogin
Log in procedure, function accepted login/password and returns session id unique for user

### query type: POST
### arguments:
* login:string
* password:string

### return values:
* sessionid:string: unique session identifier, needed for other api functions
* status:string - can be one of common status values or:
  * invalid_password: login/password mismatch
  * user_not_active: user registered, but not activated using special link sent to email

### curl example:
```
curl -X POST -d "{\"login\": \"user\", \"password\": \"12345678\"}" http://localhost:18880/api/userLogin
```
### responses examples:
```
{"sessionid": "863fe99ef908bc4ba7e954c381224f0370d8840ef6c653b14eba865caafb87c4aa2635312099a72aedc450c8dfa2d87e37641271d927c474b661afc73552d9fc","status": "ok"}
```
```
{"sessionid": "","status": "user_not_active"}
```
```
{"sessionId": "","status": "invalid_password"}
```

## userLogout
Close user session, invalidate session id

### query type: POST
### arguments:
* id:string - unique user session id returned by userlogin function

### return values:
* status:string - can be one of common status values or:
  * unknown_id: invalid session id

### curl example:
```
curl -X POST -d "{\"id\": \"d6c6a5b8839f4af4eac0e085a25d87efa27c56be6930763877a1410238d6d16b8e83f080719d7d0e6a0a7f927b257f39328ec67922dbdbf5a31c09d9e9413071\"}" http://localhost:18880/api/userLogout
```

### response examples:
```
{"status": "ok"}
```
```
{"status": "unknown_id"}
```

## userGetCredentials
Query user information

### query type: POST
### arguments:
* id:string - unique identifier of operation generated by another api function

### return values:
* status:string - can be one of common status values or:
  * unknown_id: invalid session id
* name:string
* email:string
* registrationDate:integer - uses unix time format

### curl example:
```
curl -X POST -d "{\"id\": \"f8cb3890197f7b4c981e0cec4d28125fca9ea28fe2928121184e1b3a7e4f28048606b6dcead1281b836dafcb540ca507c86d0e2066a595b6fc8c7c3509699c24\"}" http://localhost:18880/api/userGetCredentials
```

### response examples:
```
{"status": "ok","name": "user","email": "my@email.com","registrationDate": 1594539116}
```

## userGetSettings
Returns user payout settings for each coin

### query type: POST
### arguments
* id:string - unique user session id returned by userlogin function

### return values:
Array of JSON objects with these fields:

* status:string - can be one of common status values or:
  * unknown_id: invalid session id
* name:string - coin ticker
* address:string - payout address; can be null
* payoutThreshold:integer: minimal value for automatic payout; can be null
* autoPayoutEnabled:boolean - enables or disables automatic payouts

### curl example:
```
curl -X POST -d "{\"id\": \"d71f5e21d7273b268178d43a0df53449374b846d8043fbd0038a85182f499624fdc79db62d436b189f6a0f9e810a5620decf5e30edfcb2cdc9c63c13bebcd2e2\"}" http://localhost:18880/api/userGetSettings
```
### response examples:
```
{
   "status":"ok",
   "coins":[
      {
         "name":"BTC",
         "address":null,
         "payoutThreshold":null,
         "autoPayoutEnabled":false
      },
      {
         "name":"XPM",
         "address":"ATWDYBwVDvswyZADMbEo5yBt4tH2zfGjd1",
         "payoutThreshold":"100.00",
         "autoPayoutEnabled":true
      }
   ]
}
```

## userUpdateSettings
Update user payout settings for specific coin

### query type: POST
### arguments:
* id:string - unique user session id returned by userlogin function
* coin:string
* address:string
* payoutThreshold:string - minimal threshold for automatic payout
* autoPayoutEnabled:boolean - enable or disable automatic payouts

### return values:
* status:string - can be one of common status values or:
  * unknown_id: invalid session id

### curl example:
```
curl -X POST -d "{\"id\": \"147a30085b6f45a693e1dd2ec2c69642eb15df4fd53256111522c0ee1d63e0e68cfdb3c2a01c5be521abf3e51e00f29e86c49a059bdb842f9546304e8cadfef4\", \"coin\": \"XPM\", \"address\": \"ATWDYBwVDvswyZADMbEo5yBt4tH2zfGjd1\", \"payoutThreshold\": \"100\", \"autoPayoutEnabled\": true}" http://localhost:18880/api/userUpdateSettings
```
### response examples:
```
{"status": "ok"}
```

# Backend API functions

## backendManualPayout
Force payout all funds from user balance

### query type: POST
### arguments:
* id:string - unique user session id returned by userlogin function
* coin:string

### return values:
* status:string - can be one of common status values
* result:boolean - true if payout scheduled or false if balance is less than minimal allowed payout value

### curl example:
```
curl -X POST -d '{"id": "ae860bab2faca258c790563a5f97640e55c3c8f23df3fbfde07ed46e201beebbcd04f5b536c5aaf07969c55b09c569c46f37bcfb896c6931be2f9cc4bc6372f8", "coin": "XPM.testnet"}' http://localhost:18880/api/backendManualPayout
```
### response examples:
```
{"status": "ok","result": true}
```

## backendQueryUserBalance
Function returns user balance, requested and paid values for one or all available coins

### query type: POST
### arguments:
* id:string - unique user session id returned by userlogin function
* coin:string

### return values:
* status:string - can be one of common status values or:
  * unknown_id: invalid session id
* balances: array of balance objects with fields 'coin', 'balance', 'requested' and 'paid'

### curl example:
```
curl -X POST -d '{"id": "7ee12d4f88c54b2a9c850f5d744c1b27cfd5bdf30892e25b197e4c0921b1c9038d17b34e8537f078919b995eab3aae5dab43a944359e40fcffd1171dfceed019"}' http://localhost:18880/api/backendQueryUserBalance
curl -X POST -d '{"id": "7ee12d4f88c54b2a9c850f5d744c1b27cfd5bdf30892e25b197e4c0921b1c9038d17b34e8537f078919b995eab3aae5dab43a944359e40fcffd1171dfceed019", "coin": "XPM.testnet"}' http://localhost:18880/api/backendQueryUserBalance
```

### response examples:
```
{
   "status":"ok",
   "balances":[
      {
         "coin":"XPM.testnet",
         "balance":"29.31",
         "requested":"0.00",
         "paid":"3286.21"
      }
   ]
}
```
```
{
   "status":"ok",
   "balances":[
      {
         "coin":"BTC",
         "balance":"0.00",
         "requested":"0.00",
         "paid":"0.00"
      },
      {
         "coin":"XPM.testnet",
         "balance":"29.31",
         "requested":"0.00",
         "paid":"3286.21"
      }
   ]
}
```

## backendQueryFoundBlocks:
Function returns blocks found by pool, authorization not required.

### query type: POST
### arguments:
* coin:string
* heightFrom:integer (default: -1) - search blocks from this height
* hashFrom:string (default: "") - search blocks from this hash. You need use this 2 arguments for implement page by page loading. With default (or omitted) values search starts from last found block.
* count:integer (default: 20) - requested blocks count
With default arguments function returns last 20 blocks found by pool

### return values:
* status:string - can be one of common status values:
* blocks: array of block objects with fields:
  * height:integer
  * hash:string
  * time:integer (unix time format)
  * confirmations:integer - block confirmations number. -1: means orphan; -2: no data
  * generatedCoins:string - usually first coinbase output value
  * foundBy:string - name (or login) of block founder

### curl example:
```
curl -X POST -d '{"coin": "XPM.testnet", "count": 3}' http://localhost:18880/api/backendQueryFoundBlocks
```


### response examples:
```
{
   "status":"ok",
   "blocks":[
      {
         "height":2466264,
         "hash":"e1d91b43b41ecad70f057b1d7953f8f53ad6c8b9afd7ff78a4bb9f7a8f39526d",
         "time":1595533509,
         "confirmations":107,
         "generatedCoins":"29.32",
         "foundBy":"user"
      },
      {
         "height":2466263,
         "hash":"478546502f05c2622bb597b8d7faee6fe74527738d987a5e225a38f258ceb619",
         "time":1595533507,
         "confirmations":108,
         "generatedCoins":"29.32",
         "foundBy":"user"
      },
      {
         "height":2466262,
         "hash":"c38c1918a136003cc9cd75599acb31bd3dec7b89142792401953a16de879c2e5",
         "time":1595533504,
         "confirmations":109,
         "generatedCoins":"29.32",
         "foundBy":"user"
      }
   ]
}
```

## backendQueryPayouts
Returns sent payouts for user (time and transaction id for each)

### query type: POST
### arguments:
* id:string - unique user session id returned by userlogin function
* coin:string
* timeFrom:integer (unix time, default: 0) - search payouts from this time point. You need use this argument for implement page by page loading
* count:integer (default: 20) - requested payouts count

### return values:
* status:string - can be one of common status values:
* payouts: array of payouts objects with fields:
  * time
  * txid
  * value

### curl example:
```
curl -X POST -d '{"id": "8fa732ed14193de6c50b419dcfa1480a3ff6b96208e68a9c1496974a31cc51c035cd3e3708cfca1e50d6a80f2ff77cc4005fea23fa442d6b2dedefdad21d8857", "coin": "XPM.testnet", "count": 3}'
```

### response examples:
```
{
   "status":"ok",
   "payouts":[
      {
         "time":1595534238,
         "txid":"7b026ff4c4088fa94770f3351a07c2af3f593c7f6ffd48bc66da803372f15540",
         "value":"117.29"
      },
      {
         "time":1595533997,
         "txid":"0b331e1f7fde583fd643103e4777ae2f307aca4ec7bde412f0ab05e84ba43a80",
         "value":"117.31"
      },
      {
         "time":1595533637,
         "txid":"e4a2ec354f3abcf0b08f5e78b10dc08b525e22d5399db627606f0c36c7881fa6",
         "value":"117.31"
      }
   ]
}
```

## backendQueryPoolStats
Returns pool statistic for each coin

### query type: POST
### arguments:
* coin:string (default="")

### return values:
* status:string - can be one of common status values:
* stats: array of stat objects with fields:
  * coin:string
  * clients:integer - number of client
  * workers:integer - number of workers
  * cpus:integer - not 0 if client send this information
  * gpus:integer - not 0 if client send this information
  * asics:integer - not 0 if client send this information
  * other:integer - not 0 if client send this information
  * averageLatency:integer
  * power:integer - usually hashrate, depends on coin type

### curl example:
```
curl -X POST -d '{"coin": "XPM.testnet"}' http://localhost:18880/api/backendQueryPoolStats
```
```
curl -X POST -d '{}' http://localhost:18880/api/backendQueryPoolStats
```

### response examples:
```
{
   "status":"ok",
   "balances":[
      {
         "coin":"XPM.testnet",
         "clients":0,
         "workers":0,
         "cpus":0,
         "gpus":0,
         "asics":0,
         "other":0,
         "averageLatency":0,
         "power":0
      }
   ]
}
```
```
{
   "status":"ok",
   "stats":[
      {
         "coin":"BTC",
         "clients":0,
         "workers":0,
         "cpus":0,
         "gpus":0,
         "asics":0,
         "other":0,
         "averageLatency":0,
         "power":0
      },
      {
         "coin":"XPM.testnet",
         "clients":1,
         "workers":1,
         "cpus":0,
         "gpus":1,
         "asics":0,
         "other":0,
         "averageLatency":0,
         "power":416
      }
   ]
}
```

## backendQueryUserStats
Returns user statistic (aggregate and for each worker)

### query type: POST
### arguments:
* id:string - unique user session id returned by userlogin function
* coin:string

### return values:
* status:string - can be one of common status values
* total: object with these fields:
  * workers:integer: number of connections for current user
  * cpus - not 0 if client send this information
  * gpus - not 0 if client send this information
  * asics - not 0 if client send this information
  * other - not 0 if client send this information
  * averageLatency:integer
  * power:integer - aggregate hashrate for current user, (value depends on coin type)
* workers: array of objects with these fields:
  * name:string - worker name
  * power:integer - worker hashrate
  * latency:integer - worker latency (ms)
  * type:string - units type (CPU, GPU, ASIC)
  * units:integer - amount of units, not 0 if client send this information
  * temp:integer - average temperature of all units (usually GPUs)

### curl example:
```
curl -X POST -d '{"id": "ae860bab2faca258c790563a5f97640e55c3c8f23df3fbfde07ed46e201beebbcd04f5b536c5aaf07969c55b09c569c46f37bcfb896c6931be2f9cc4bc6372f8", "coin": "XPM.testnet"}' http://localhost:18880/api/backendQueryUserStats
```

### response examples:
```
{
   "status":"ok",
   "total":{
      "clients":0,
      "workers":1,
      "cpus":0,
      "gpus":1,
      "asics":0,
      "other":0,
      "averageLatency":0,
      "power":427
   },
   "workers":[
      {
         "name":"userpc",
         "power":427,
         "latency":0,
         "type":"GPU",
         "units":1,
         "temp":0
      }
   ]
}
```
